{% extends "users/base.html" %}

{% block title %}
    User List
{% endblock %}

{% block content %}
    <h2>User List</h2>
    <ul>
        {% for user_for_loop in user_rows_for_looping %}
            <li>
                <a href="{{ user_for_loop.get_absolute_url }}"> {{ user_for_loop }}</a>
            </li>
        {% empty %}
            <li>No users yet!</li>
        {% endfor %}
    </ul>
{% endblock %}

{% block send_search %}
    <form method="get" class="row g-2 align-itmes-center mt-4">
        <div class="col-12 col-sm-6 col-md-4">
            <input type="search" name="q" value="{{ q }}" class="form-control"
                   placeholder="Search by name">
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" type="submit">Search</button>
            {% if q %}<a class="btn btn-outline-secondary ms-2" href="{% url 'user-list-url' %}">Clear</a>{% endif %}
        </div>
    </form>
{% endblock %}

{% block filter %}
    {% if q %}
        <p class="text-muted mt-3 mb-2">result for "{{ q }}"</p>
        <div class="card">
            <ul class="list-group list-group-flush">
                {% for s in search_results %}
                    <li>
                        <a href="{{ s.get_absolute_url }}">{{ s }}</a>
                    </li>
                {% empty %}
                    <li> class="list-group-item text-muted"><em>No users found</em></li>
                {% endfor %}
            </ul>
        </div>
    {% else %}
        <p class="text-muted mt-3">result</p>
    {% endif %}
{% endblock %}

{% block stats %}
  <hr class="my-4">

  <div class="d-flex align-items-center gap-3 mb-3">
    <h5 class="mb-0">Stats</h5>
    <span class="badge bg-primary">Total users: {{ total_users }}</span>
    <span class="badge bg-secondary">Total assignments: {{ total_assignments }}</span>
  </div>

  <div class="row g-3">

    <div class="col-12 col-md-6">
      <div class="card h-100">
        <div class="card-header py-2"><strong>Assignments_per_user</strong></div>
        <div class="card-body p-0">
          <table class="table table-sm table-striped mb-0">
            <thead class="table-light">
              <tr><th>User</th><th class="text-end">Assignments</th></tr>
            </thead>
            <tbody>
              {% for row in assignments_per_user %}
                <tr>
                  <td>{{ row.user_id }} — {{ row.email }}</td>
                  <td class="text-end">{{ row.n_assignments }}</td>
                </tr>
              {% empty %}
                <tr><td colspan="2" class="text-muted"><em>No assignments.</em></td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6">
      <div class="card h-100">
        <div class="card-header py-2"><strong>Materials_per_user</strong></div>
        <div class="card-body p-0">
          <table class="table table-sm table-striped mb-0">
            <thead class="table-light">
              <tr><th>User</th><th class="text-end">Materials</th></tr>
            </thead>
            <tbody>
              {% for row in materials_per_user %}
                <tr>
                  <td>{{ row.user_id }} — {{ row.email }}</td>
                  <td class="text-end">{{ row.n_materials }}</td>
                </tr>
              {% empty %}
                <tr><td colspan="2" class="text-muted"><em>No materials.</em></td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}